---
- name: Configure Build Server for GitLab CI/CD
  hosts: build_servers
  become: yes
  tasks:
    - name: Install required packages for Alpine Linux
      apk:
        name: "{{ item }}"
        state: present
        update_cache: yes
      loop:
        - docker
        - docker-compose
        - python3
        - py3-pip
        - git
        - curl
        - python3-dev
        - libffi-dev
        - openssl-dev
        - gcc
        - musl-dev

    - name: Create virtual environment for Python packages
      command:
        cmd: python3 -m venv /opt/ansible-venv
        creates: /opt/ansible-venv/bin/activate

    - name: Install Python Docker module in virtual environment
      pip:
        name: docker
        virtualenv: /opt/ansible-venv
        virtualenv_python: python3

    - name: Display CI/CD Configuration Success
      debug:
        msg: |
          ✅ ANSIBLE CONFIGURATION COMPLETED!
          ==================================
          Build Server: {{ ansible_hostname }}
          Docker: ✅ Installed
          Docker Compose: ✅ Ready
          Python Environment: ✅ Configured
          Git: ✅ Available
          
          Next Stage: Deployment to Kubernetes